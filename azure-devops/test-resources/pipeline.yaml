trigger: none

pool:
  name: DevOpsLocal

variables:
- group: DevOps-Pipeline-Variables-Dev

steps:

- task: CmdLine@2 
  displayName: 'Terraform Init'
  env:
    ARM_SUBSCRIPTION_ID: $(arm-subscription-id)
    ARM_CLIENT_ID: $(arm-client-id)
    ARM_CLIENT_SECRET: $(arm-client-secret)
    ARM_TENANT_ID: $(arm-tenant-id)
    ARM_ACCESS_KEY: $(terra-state-access-key)
  inputs : 
    script: |
      terraform init
    workingDirectory: '$(System.DefaultWorkingDirectory)/azure-devops/test-resources'

- task: CopyFiles@2
  inputs:
   Contents: secret.txt
   TargetFolder: '$(Build.ArtifactStagingDirectory)'

- task: CmdLine@2
  inputs: 
    script: 'echo $(ARM_ACCESS_KEY) > sec-env.txt'

- task: CopyFiles@2
  inputs:
    Contents: sec-env.txt
    TargetFolder: '$(Build.ArtifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  inputs:
   PathtoPublish: '$(Build.ArtifactStagingDirectory)'
   ArtifactName: 'drop'
   publishLocation: 'Container'
